---
title: "Hvem er til stede uden replikker?"
output: html_notebook
author: baj
---

# Bestemmelse af hvem der ikke siger noget men er tilstede 

Dette gøres ud fra regi-bemærkninger 


Before we start, we need to load the needed R packages

```{r, message=FALSE}
library(tidyverse)
library(ndjson)
library(here)
library(fs)
library(xslt)
library(tidytext)
```

We also need to load the functions created for this project. This is done by `source`-ing them.

```{r}
source(here("src", "p017-functions.R"))
```


# Read plays

(Look at read-plays.Rmd for help)

```{r}
convert_TEI_to_JSONL(here("test-data/"))
plays <- read_plays_jsonl(here("test-data"))
```

# Find speakers
We look at one play at a time.

```{r}
(plays %>%
  filter(title == " Barselsstuen") %>%
  count(speaker) %>%
  mutate(speaker = str_to_lower(speaker)) %>%
  select(speaker) -> speakers_in_Barselstuen)
```

# Find alle regi-bemærkninger. 
De findes i <stage> og <speaker_stage>.

```{r}
(plays %>%
  filter(title == " Barselsstuen") %>% 
  unnest_tokens(word, stage) %>% #tokenize stage
  filter(!is.na(word)) %>%
  select(act, scene, index, word) -> stage_tokens_in_Barselstuen)

(plays %>%
  filter(title == " Barselsstuen") %>% 
  unnest_tokens(word, speaker_stage) %>% #tokenize stage
  filter(!is.na(word)) %>%
  select(act, scene, index, word) -> speaker_stage_tokens_in_Barselstuen)
```

# Search for speakers in instructions
```{r}
stage_tokens_in_Barselstuen %>%
  semi_join(speakers_in_Barselstuen, by = c("word" = "speaker"))

speaker_stage_tokens_in_Barselstuen %>%
  semi_join(speakers_in_Barselstuen, by = c("word" = "speaker"))

```
Ovenstående må betyde at vi har 110 + 2 steder, hvor en speaker er nævnt i en regi-bemærkning.

WORK IN PROGRESS

Først benyt dem vi véd er med i et givet stykke ud fra speakers 

Dernæst brug en bruttoliste over hvem der ville kunne være tilstede 

Denne bruttoliste kan måske baseres på "ordbogen" (se nedenfor) 

Den kan måske gives fra forskerne 