---
title: "Dramatiske overgange"
output: html_notebook
author: baj
---

# Spørgsmål til Holbergs skrifter

Find første sætning i hver scene.
Find sidste sætning i hver scene.

# From TEI to JSONL

We have written an XSL transformation to transform the TEI format into JSONL, as this is a better format for reading into R.

# Read a play into R

Load the JSONL data format

```{r}
library(tidyverse)
library(ndjson)
library(here)

barselstuen_raw <- ndjson::stream_in(here("/test-data/barselstuen_mod.jsonl")) %>% tibble()

```

# Looking at the data

```{r}
barselstuen_raw
```

##Find første sætning i hver scene.
index is counter (inside the scene, it resets with each new scene)


```{r}
barselstuen_raw %>% 
  filter(index == "1")

```

Det er ikke helt godt, for det er ofte en <stage> eller en <speaker-stage>, der er det første i hver scene.
Første akt, Scene 2 starter sådan her:
<div xml:id="act1sc2" n="Scene 2">
               <head>Scene 2</head>
               <stage>Claus, Troels</stage>
               <sp>
                  <speaker>Claus</speaker>
                  <p><seg type="komm" target="E7r-9"/>Ak, kære Troels, veksl mig <seg type="komm" target="E7r-9b"/>en toskilling for to eneste skillinger!</p>
               </sp>

Mon den har fået index 2?

```{r}
barselstuen_raw %>% 
  filter(act == "Første akt") %>%
  filter(scene == "Scene 2") %>%
  filter(index == "2")

```

Jeps, der var den.
Vi kan prøve at hoppe den linje over, men hvordan gør vi det?

```{r}
barselstuen_spoke1 <- barselstuen_raw %>% filter(index == "1", !is.na(spoke))
barselstuen_spoke1

```

Det ser faktisk ud til at der kun er et sted hvor der faktisk er tale med index 1...
Hjælp fra Asger:

```{r}
first_sentence <- barselstuen_raw %>%
  #Group by så vi håndterer hver scene for sig
 group_by(act_number, scene_number) %>%
  #Filtrer alle linier som ikke er replikker fra
 filter(!is.na(spoke)) %>%
  # Sorter i hver gruppe, så linierne kommer i rækkefølge
 arrange(index, .by_group = TRUE) %>%
  # Lav et ny index i hver gruppe, startende med den første.
  # På den måde ved jeg at den første i hver gruppe er nr 1.
 mutate(group_row_num = row_number()) %>%
  # Kun behold den første i hver gruppe
 filter(group_row_num == 1) %>%
  # Fjern gruppe index for det er ikke relevant længere
 select(- group_row_num )

first_sentence
```

Det virker. 
Vi skal lige huske at gemme resultatet:

```{r}
write.csv(first_sentence, file = here("data/output/barselstuen_first_sentence.csv"))
```


Mon ikke vi kan gøre noget tilsvarende for at finde den sidste sætning i hver scene?
Hjælp fra Asger:


```{r}
last_sentence <- barselstuen_raw %>%
  #Group by så vi håndterer hver scene for sig
 group_by(act_number, scene_number) %>%
  #Filtrer alle linier som ikke er replikker fra
 filter(!is.na(spoke)) %>%
  # Sorter i hver gruppe, så linierne kommer i omvendt rækkefølge
 arrange(desc(index), .by_group = TRUE) %>%
  # Lav et ny index i hver gruppe, startende med den sidste.
  # På den måde ved jeg at den sidste i hver gruppe er nr 1.
 mutate(group_row_num = row_number()) %>%
  # Kun behold den sidste i hver gruppe
 filter(group_row_num == 1) %>%
  # Fjern gruppe index for det er ikke relevant længere
 select(- group_row_num )

write.csv(last_sentence, file = here("data/output/barselstuen_last_sentence.csv"))
```





