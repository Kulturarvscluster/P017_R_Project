---
title: "Hvordan læses stykkerne ind i R?"
output: html_notebook
author: pmd
---
Stykkerne er i TEI format. Dette format har ikke en standard indlæsningsmetod til R. Derfor transformerer vi TEI filerne over i et format der bedre passer til R. Vi har her valgt JSONL, men kunne have valgt andre formater. I JSONL formatet er hver linie i sig selv en stump valid JSON, mens filen som et hele ikke er valid JSON. Dette gør, at hver linie kan læses uafhængigt af hele filen.

For at gøre dette nemt, har vi skrevet to små R funktioner. En der transformerer alle TEI filer i en mappe og en der indlæser alle JSONL filer i en mappe til R. TEI filer er identificeret ved at deres filnanv ender med ".page".

Denne notebook illustrerer brugen af disse to funktioner.

Før vi starter skal vi indlæse de nødvendige udvidelsespakker til R.

```{r, message=FALSE}
library(tidyverse)
library(ndjson)
library(here)
library(fs)
library(xslt)
```

De to hjælpefunktioner er defineret i `src/p017-functions.R`, som vi indlæser på følgende vis

```{r}
source(here("src", "p017-functions.R"))
```

# Transformation af TEI filer

Vi har placeret to testfiler i mappen `test-data`

```{r}
dir_ls(here("test-data/"))
```

For at transformere disse to filer, gør vi følgende

```{r}
convert_TEI_to_JSONL(here("test-data/"))
```

Hvis vi nu igen ser i mappen `test-data`, kan vi se at der er kommet to nye filer

```{r}
dir_ls(here("test-data/"))
```

# Indlæsning af JSONL filer til R

Vi kan nu indlæse de to nye JSONL filer på følgende vis

```{r}
read_plays_jsonl(here("test-data")) -> plays
```

Lad os kort se på fx hvor mange rækker, vi har i hvert af de to skuespil.

```{r}
plays %>% 
  count(title)
```
